---
import ImageWrapper from "../components/misc/ImageWrapper.astro";
import I18nKey from "../i18n/i18nKey";
import { i18n } from "../i18n/translation";
import MainGridLayout from "../layouts/MainGridLayout.astro";

// 追番数据
const animeList = [
	{
		title: "莉可丽丝",
		status: "completed",
		rating: 9.8,
		cover: "assets/anime/lkls.webp",
		description: "少女枪战，瑕不掩瑜",
		episodes: "12 episodes",
		year: "2013-2023",
		link: "https://www.bilibili.com/bangumi/media/md28338623",
	},
	{
		title: "若叶女孩",
		status: "watching",
		rating: 9.5,
		cover: "assets/anime/rynh.webp",
		description: "少女日常，清甜治愈。",
		episodes: "12 episodes",
		year: "2019-2023",
		link: "https://www.bilibili.com/bangumi/media/md2590",
	},
	{
		title: "恋爱小行星",
		status: "watching",
		rating: 9.2,
		cover: "assets/anime/laxxx.webp",
		description: "星遇少女，纯爱治愈。",
		episodes: "24 episodes",
		year: "2020-2024",
		link: "https://www.bilibili.com/bangumi/media/md28224128",
	},
	{
		title: "请问您今天要来点兔子吗？？",
		status: "completed",
		rating: 9.0,
		cover: "assets/anime/tz1.webp",
		description: "一群少女的温馨日常",
		episodes: "12 episodes",
		year: "2022-2023",
		link: "https://www.bilibili.com/bangumi/media/md2762",
	},
];

// 获取状态的翻译文本
function getStatusText(status: string): string {
	switch (status) {
		case "watching":
			return i18n(I18nKey.animeStatusWatching);
		case "completed":
			return i18n(I18nKey.animeStatusCompleted);
		default:
			return status;
	}
}
---

<MainGridLayout title={i18n(I18nKey.anime)} description="我的追番记录">
	<div class="flex w-full rounded-[var(--radius-large)] overflow-hidden relative min-h-32">
		<div class="card-base z-10 px-9 py-6 relative w-full">
			<div class="relative">
				<div class="flex flex-row items-center text-lg font-bold mb-6 text-90">
					<div class="flex flex-row items-center">
						<svg class="w-6 h-6 mr-2 text-90" fill="currentColor" viewBox="0 0 24 24">
							<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
						</svg>
						<span>{i18n(I18nKey.anime)}</span>
					</div>
				</div>

				<!-- 统计信息 -->
				<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
					<div class="card-base p-4 text-center">
						<div class="text-2xl font-bold text-[var(--primary)]">{animeList.length}</div>
						<div class="text-sm text-75">{i18n(I18nKey.animeTotal)}</div>
					</div>
					<div class="card-base p-4 text-center">
						<div class="text-2xl font-bold text-[oklch(0.65_0.15_140)] dark:text-[oklch(0.75_0.15_140)]">{animeList.filter(anime => anime.status === 'watching').length}</div>
						<div class="text-sm text-75">{i18n(I18nKey.animeWatching)}</div>
					</div>
					<div class="card-base p-4 text-center">
						<div class="text-2xl font-bold text-[oklch(0.65_0.15_240)] dark:text-[oklch(0.75_0.15_240)]">{animeList.filter(anime => anime.status === 'completed').length}</div>
						<div class="text-sm text-75">{i18n(I18nKey.animeCompleted)}</div>
					</div>
				</div>

				<!-- 动漫列表 -->
				<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
					{animeList.map(anime => (
						<div class="card-base p-4 hover:shadow-lg transition-shadow">
							<div class="flex items-start gap-3">
								<a href={anime.link} target="_blank" rel="noopener noreferrer" class="w-16 h-20 rounded flex-shrink-0 overflow-hidden hover:opacity-80 transition-opacity cursor-pointer">
									<ImageWrapper 
										src={anime.cover} 
										alt={anime.title}
										class="w-16 h-20 rounded"
									/>
								</a>
								<div class="flex-1">
									<h3 class="font-bold text-lg mb-2 text-90">{anime.title}</h3>
									<p class="text-sm text-75 mb-3">{anime.description}</p>
									
									<div class="flex items-center gap-4 text-sm mb-2">
										<div class="flex items-center gap-1">
											<span class="text-50">评分:</span>
											<div class="flex items-center">
												{Array.from({length: 5}, (_, i) => (
													<svg class={`w-4 h-4 ${i < anime.rating ? 'text-[oklch(0.75_0.15_80)] dark:text-[oklch(0.85_0.15_80)]' : 'text-30'}`} fill="currentColor" viewBox="0 0 20 20">
														<path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
													</svg>
												))}
											</div>
										</div>
									</div>
									
									<div class="flex items-center justify-between">
										<span class={`px-2 py-1 rounded-full text-xs font-medium ${
											anime.status === 'watching' ? 'bg-[oklch(0.85_0.1_140)] text-[oklch(0.35_0.15_140)] dark:bg-[oklch(0.25_0.1_140)] dark:text-[oklch(0.75_0.15_140)]' :
											anime.status === 'completed' ? 'bg-[oklch(0.85_0.1_240)] text-[oklch(0.35_0.15_240)] dark:bg-[oklch(0.25_0.1_240)] dark:text-[oklch(0.75_0.15_240)]' :
											'bg-[var(--btn-regular-bg)] text-75'
										}`}>
											{getStatusText(anime.status)}
										</span>
									</div>
								</div>
							</div>
						</div>
					))}
				</div>


			</div>
		</div>
	</div>
</MainGridLayout>

<style>
	.card-base {
		background: var(--card-bg);
		border: 1px solid var(--line-divider);
	}
</style>